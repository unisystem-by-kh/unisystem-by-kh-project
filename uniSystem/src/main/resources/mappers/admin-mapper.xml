<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="adminmapper">

	<resultMap type="Member" id="member_rm">
   
      <!-- DB의 기본 키(복합키면 여러 개 작성) -->
      <id property="memberNo" column="MEMBER_NO" />

      <!-- DB의 일반 컬럼들 -->
      <result property="memberPw" column="MEMBER_PW" />
      <result property="memberAddr" column="MEMBER_ADDR" />
      <result property="memberEmail" column="MEMBER_EMAIL" />
      <result property="memberPhone" column="MEMBER_PHONE" />
      <result property="memberGen" column="MEMBER_GEN" />
      <result property="memberDate" column="MEMBER_DATE" />
      <result property="memberGrade" column="MEMBER_GRADE" />
      <result property="memberTerm" column="MEMBER_TERM" />
      <result property="memberStatus" column="MEMBER_STATUS" />
      <result property="memberName" column="MEMBER_NAME" />
      <result property="memberProfile" column="MEMBER_PROFILE" />
      <result property="memberSsn" column="MEMBER_SSN" />
      
      <result property="departmentNo" column="DEPARTMENT_NO" />
      
   </resultMap>
   
   <resultMap type="StudentList" id="student_rm">
   		<id property="memberNo" column="MEMBER_NO" />
   		
   		<result property="memberName" column="MEMBER_NAME"/>
   		<result property="memberGrade" column="MEMBER_GRADE"/>
   		<result property="deptName" column="DEPARTMENT_NAME"/>
   		<result property="memberStatus" column="MEMBER_STATUS"/>
   		<result property="classPoint" column="CLASS_POINT"/>
   		<result property="requestType" column="REQUEST_TYPE"/>
   		<result property="requestReason" column="REQUEST_REASON"/>
   </resultMap>

<!--    <select id="selectList" resultMap="member_rm"> -->
<!--    	SELECT * FROM MEMBER; -->
<!--    </select> -->
   
<!--    <insert id="saveUniqueNo" parameterType="member_rm"> -->
<!--       INSERT INTO MEMBER ( -->
<!--         MEMBER_NO, -->
<!--         MEMBER_NAME, -->
<!--         MEMBER_SSN, -->
<!--         DEPARTMENT_NO -->
<!--     ) -->
<!--     VALUES ( -->
<!--         #{memberNo}, #{memberName}, #{memberSsn} , #{departmentNo} -->
<!--     ) -->
<!-- 	</insert> -->
	
	<!-- 학생 정보 조회 -->
	<select id="selectStudentList" resultMap="student_rm">
		<![CDATA[
			SELECT 
			    M.MEMBER_NO ,
			    MEMBER_NAME, 
			    MEMBER_GRADE, 
			    DEPARTMENT_NAME, 
			    MEMBER_STATUS, 
			    NVL(SUM(CASE WHEN L.LECTURE_POINT >= 1 THEN CLASS_POINT ELSE 0 END), 0) AS CLASS_POINT,
			    REQUEST_TYPE,
			    REQUEST_REASON
			FROM 
			    MEMBER M, LECTURE L, CLASS C, DEPARTMENT D, REQUEST R
			WHERE 
			    L.MEMBER_NO(+) = M.MEMBER_NO
			    AND C.CLASS_NO(+) = L.CLASS_NO
			    AND M.DEPARTMENT_NO = D.DEPARTMENT_NO
			    AND M.MEMBER_NO = R.MEMBER_NO(+)
			    AND SUBSTR(M.MEMBER_NO, 1,2) = '01'
			GROUP BY 
			    M.MEMBER_NO, MEMBER_NAME, MEMBER_GRADE, DEPARTMENT_NAME, MEMBER_STATUS, REQUEST_TYPE, REQUEST_REASON
		]]>
	</select>
	  


</mapper>









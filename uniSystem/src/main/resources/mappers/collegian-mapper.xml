<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="collegianMapper">

	<resultMap type="Class" id="class_rm">

		<!-- DB의 기본 키(복합키면 여러 개 작성) -->
		<id property="classNo" column="CLASS_NO" />

		<!-- DB의 일반 컬럼들 -->
		<result property="className" column="CLASS_NM" />
		<result property="classPoint" column="CLASS_POINT" />
		<result property="classMax" column="CLASS_MAX" />
		<result property="classGrade" column="CLASS_GRADE" />
		<result property="classTrem" column="CLASS_TREM" />
		<result property="classDay" column="CLASS_DAY" />
		<result property="classStart" column="CLASS_START" />
		<result property="classEnd" column="CLASS_END" />

		<result property="departmentNo" column="DEPARTMENT_NO" />
		<result property="departmentName" column="DEPARTMENT_NAME" />

		<result property="memberNo" column="MEMBER_NO" />
		<result property="memberName" column="MEMBER_NAME" />

	</resultMap>

	<!-- 교과목 수 -->
	<select id="getListCount" resultType="_int">
		SELECT COUNT(*) FROM CLASS
		WHERE DEPARTMENT_NO = #{departmentNo}
		AND CLASS_GRADE = #{memberGrade}
		AND CLASS_TREM = #{memberTerm}
	</select>

	<!-- 교과목 조회 결과 -->
	<select id="selectClassList" resultMap="class_rm">
		SELECT CLASS_NO, CLASS_NM, CLASS_POINT, CLASS_GRADE, CLASS_TREM, CLASS_DAY,
		CLASS_START, CLASS_END, DEPARTMENT_NAME, MEMBER_NAME
		FROM CLASS A
		JOIN DEPARTMENT B ON ( A.DEPARTMENT_NO = B.DEPARTMENT_NO)
		JOIN MEMBER USING (MEMBER_NO)
		WHERE CLASS_GRADE = #{memberGrade}
		AND CLASS_TREM =#{memberTerm}
		AND A.DEPARTMENT_NO = #{departmentNo}
	</select>

	<select id="getListCount_search" resultType="_int">
		SELECT COUNT(*) FROM CLASS

		WHERE CLASS_NM IS NOT NULL

		<choose>
			<when test='major != "0"'>
				AND DEPARTMENT_NO = #{major}
			</when>

			<when test='grade != "0"'>
				AND CLASS_GRADE = #{grade}
			</when>

			<when test='step != "0"'>
				AND CLASS_TREM = #{step}
			</when>

			<when test='type != "0"'>
				AND CLASS_POINT = #{type}
			</when>

		</choose>

	</select>

	<select id="selectClassList_search" resultMap="class_rm">
		SELECT CLASS_NO, CLASS_NM, CLASS_POINT, CLASS_GRADE, CLASS_TREM,
		CLASS_DAY, CLASS_START, CLASS_END, DEPARTMENT_NAME, MEMBER_NAME
		FROM CLASS A
		JOIN DEPARTMENT B ON ( A.DEPARTMENT_NO = B.DEPARTMENT_NO)
		JOIN MEMBER USING (MEMBER_NO)
		WHERE CLASS_NM IS NOT NULL
		<choose>
			<when test='major != "0"'>
				AND A.DEPARTMENT_NO = #{major}
			</when>
		</choose>

		<if test='grade != "0"'>
			AND CLASS_GRADE = #{grade}
		</if>

		<if test='step != "0"'>
			AND CLASS_TREM = #{step}
		</if>

		<if test='type != "0"'>
			AND CLASS_POINT = #{type}
		</if>
	</select>






</mapper>

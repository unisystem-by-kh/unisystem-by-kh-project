<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="boardMapper">

   <!-- Board DTO에 대한 resultMap -->
   <resultMap type="Board" id="board_rm">
      <id property="boardNo" column="BOARD_NO" />

      <result property="boardTitle" column="BOARD_TITLE" />
      <result property="boardContent" column="BOARD_CONTENT" />
      <result property="boardCDate" column="BOARD_C_DATE" />
      <result property="boardUDate" column="BOARD_U_DATE" />
      <result property="boardCount" column="READ_COUNT" />
      <result property="replyCount" column="REPLY_COUNT" />
      <result property="memberName" column="MEMBER_NAME" />
      <result property="memberNo" column="MEMBER_NO" />
      <result property="profileImage" column="PROFILE_IMG" />
      <result property="boardCode" column="CATEGORY_NO" />
      <result property="boardSt" column="BOARD_ST" />

      <!-- <collection property="imageList" select="selectImageList"
         column="BOARD_NO" javaType="java.util.ArrayList" ofType="BoardImage">
      </collection> -->

     <!--  <collection property="commentList"
         select="selectCommentList" column="BOARD_NO"
         javaType="java.util.ArrayList" ofType="Comment">
      </collection>  -->

   </resultMap>

   <!-- 게시판 종류 목록 조회 -->
   <select id="selectBoardTypeList" resultType="map">
      SELECT * FROM
      CATEGORY ORDER BY 1
   </select>

   <!-- 특정 게시판의 삭제되지 않은 게시글 수 조회 -->
   <select id="getListCount" resultType="_int">
      SELECT COUNT(*) FROM BOARD
      WHERE BOARD_ST = 'N'
      AND CATEGOTY_NO = ${boardCode}
   </select>

   <!-- 게시글 목록 조회 -->
   <!-- <select id="selectFreeBoardList" resultMap="board_rm">
      SELECT BOARD_NO, BOARD_TITLE, MEMBER_NICKNAME, READ_COUNT, 
         
		<![CDATA[
		CASE  
		   WHEN SYSDATE - B_CREATE_DATE < 1/24/60
		   THEN FLOOR( (SYSDATE - B_CREATE_DATE) * 24 * 60 * 60 ) || '초 전'
		   WHEN SYSDATE - B_CREATE_DATE < 1/24
		   THEN FLOOR( (SYSDATE - B_CREATE_DATE) * 24 * 60) || '분 전'
		   WHEN SYSDATE - B_CREATE_DATE < 1
		   THEN FLOOR( (SYSDATE - B_CREATE_DATE) * 24) || '시간 전'
		   ELSE TO_CHAR(B_CREATE_DATE, 'YYYY-MM-DD')
		END B_CREATE_DATE,
		]]>
		
      (SELECT COUNT(*) FROM "COMMENT" C
      WHERE C.BOARD_NO = B.BOARD_NO
      AND C.COMMENT_DEL_FL = 'N') COMMENT_COUNT,

      (SELECT IMG_PATH || IMG_RENAME FROM BOARD_IMG I
      WHERE I.BOARD_NO = B.BOARD_NO
      AND IMG_ORDER = 0) THUMBNAIL
      FROM "BOARD" B
      JOIN "MEMBER" USING(MEMBER_NO)
      WHERE BOARD_DEL_FL = 'N'
      AND BOARD_CODE = ${boardCode}
      ORDER BY BOARD_NO DESC
   </select> -->
	
	
	<select id="selectinquiryBoardList" resultMap="board_rm">
		 SELECT BOARD_NO, BOARD_TITLE, MEMBER_NAME, BOARD_COUNT, BOARD_ST,
         
		<![CDATA[
		CASE  
		   WHEN SYSDATE - BOARD_C_DATE < 1/24/60
		   THEN FLOOR( (SYSDATE - BOARD_C_DATE) * 24 * 60 * 60 ) || '초 전'
		   WHEN SYSDATE - BOARD_C_DATE < 1/24
		   THEN FLOOR( (SYSDATE - BOARD_C_DATE) * 24 * 60) || '분 전'
		   WHEN SYSDATE - BOARD_C_DATE < 1
		   THEN FLOOR( (SYSDATE - BOARD_C_DATE) * 24) || '시간 전'
		   ELSE TO_CHAR(BOARD_C_DATE, 'YYYY-MM-DD')
		END BOARD_C_DATE,
		]]>
		
      (SELECT COUNT(*) FROM "REPLY" C
      WHERE C.BOARD_NO = B.BOARD_NO
      AND C.REPLY_ST = 'N') REPLY_COUNT

      FROM "BOARD" B
      JOIN "MEMBER" USING(MEMBER_NO)
      WHERE (BOARD_ST = 'N' OR BOARD_ST = 'D')
      AND CATEGOTY_NO = ${boardCode}
      ORDER BY BOARD_NO DESC
	</select>




</mapper>









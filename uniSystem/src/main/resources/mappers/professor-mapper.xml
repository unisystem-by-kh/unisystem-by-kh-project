<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="professorMapper">

	<resultMap type="Member" id="member_rm">
	  
	     <!-- DB의 기본 키(복합키면 여러 개 작성) -->
		<id property="memberNo" column="MEMBER_NO" />
		
		<!-- DB의 일반 컬럼들 -->
		<result property="memberPw" column="MEMBER_PW" />
		<result property="memberAddr" column="MEMBER_ADDR" />
		<result property="memberEmail" column="MEMBER_EMAIL" />
		<result property="memberPhone" column="MEMBER_PHONE" />
		<result property="memberGen" column="MEMBER_GEN" />
		<result property="memberDate" column="MEMBER_DATE" />
		<result property="memberGrade" column="MEMBER_GRADE" />
		<result property="memberTerm" column="MEMBER_TERM" />
		<result property="memberStatus" column="MEMBER_STATUS" />
		<result property="memberName" column="MEMBER_NAME" />
		<result property="memberProfile" column="MEMBER_PROFILE" />
		<result property="memberSsn" column="MEMBER_SSN" />
			   
			   
		<result property="departmentNo" column="DEPARTMENT_NO" />
		<result property="departmentName" column="DEPARTMENT_NAME" />
		
		<result property="memberAge" column="MEMBER_AGE" />
		<result property="lecturePoint" column="LECTURE_POINT" />
	   
	</resultMap>
	

	<!-- 현재 재적중인 학생 수 조회 -->	
	<select id="getListCount" resultType="_int">
		SELECT COUNT(*)
		FROM MEMBER
		WHERE MEMBER_STATUS = 'N'
		AND SUBSTR(MEMBER_NO, 1, 2) = '01'
	</select>
	
	<!-- 현재 재적중인 학생 목록 조회 -->
	<select id="selectStudent" resultMap="member_rm">
		SELECT M.MEMBER_NO, M.MEMBER_PW, M.MEMBER_ADDR, M.MEMBER_EMAIL, M.MEMBER_PHONE, M.MEMBER_GEN, M.MEMBER_DATE, M.MEMBER_GRADE, M.MEMBER_TERM, M.MEMBER_STATUS, M.MEMBER_NAME, M.MEMBER_PROFILE, M.MEMBER_SSN,
		    CASE
		        WHEN SUBSTR(MEMBER_SSN, 1, 2) BETWEEN '00' AND '21' THEN TO_CHAR(SYSDATE, 'YYYY') - TO_NUMBER('20' || SUBSTR(MEMBER_SSN, 1, 2)) - 1
		        ELSE TO_CHAR(SYSDATE, 'YYYY') - TO_NUMBER('19' || SUBSTR(MEMBER_SSN, 1, 2)) - 1
		    END AS MEMBER_AGE,
		    D.DEPARTMENT_NO, D.DEPARTMENT_NAME, L.LECTURE_POINT
		FROM MEMBER M
		JOIN DEPARTMENT D ON M.DEPARTMENT_NO = D.DEPARTMENT_NO
		JOIN LECTURE L ON L.MEMBER_NO = M.MEMBER_NO
		WHERE SUBSTR(M.MEMBER_NO, 1, 2) = '01'
		AND M.MEMBER_GRADE = L.LECTURE_GRADE
		AND M.MEMBER_TERM = L.LECTURE_TERM
		AND MEMBER_STATUS = 'N'
	</select>
	

</mapper>








